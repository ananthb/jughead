{{- $mermaidJs := resources.Get "mermaid/mermaid.esm.mjs" -}}
<script type="importmap">
  {{- if hugo.IsProduction -}}
  {{- $mermaidJs = $mermaidJs | minify | fingerprint "sha512" -}}
  {
    "integrity": {
      "{{ $mermaidJs.RelPermalink }}": "{{ $mermaidJs.Data.Integrity }}"
    }
  }
  {{- end -}}
</script><script type="module">
  import mermaid from {{ $mermaidJs.RelPermalink }};
  {{- range resources.Match "mermaid/chunks/mermaid.esm/*.mjs" -}}
  import "{{ .RelPermalink }}";
  {{ end -}}

  let theme = "default";
  if (
    window.matchMedia &&
    window.matchMedia("(prefers-color-scheme: dark)").matches
  ) {
    // dark mode
    theme = "dark";
  }
  const config = {
    startOnLoad: true,
    align: "center",
    theme: theme,
  };
  mermaid.initialize(config);
</script>
